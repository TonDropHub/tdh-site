<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
<script>
(function(){
  try{
    var t = (localStorage.getItem('tdh_theme')||'').toLowerCase();
    if(t==='dark' || t==='light'){
      document.documentElement.setAttribute('data-theme', t);
    }
  }catch(e){}
})();
</script>

  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <title>News — TON Drop Hub</title>

  <!-- SEO -->
  <meta name="description" content="Daily actionable TON ecosystem news: short posts with sources, risks, and links." />
  <meta name="robots" content="index,follow" />
  <meta name="theme-color" content="#0b1020" />
  <meta name="color-scheme" content="dark light" />

  <!-- Canonical -->
  <link rel="canonical" href="https://tdh-site-cie.pages.dev/news/" />

  <!-- Open Graph (Telegram, Facebook, etc.) -->
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="TON Drop Hub" />
  <meta property="og:title" content="TON Drop Hub — News" />
  <meta property="og:description" content="Daily actionable TON ecosystem news: short posts with sources, risks, and links." />
  <meta property="og:url" content="https://tdh-site-cie.pages.dev/news/" />
  <meta property="og:image" content="https://tdh-site-cie.pages.dev/assets/og.jpg" />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />
  <meta property="og:image:alt" content="TON Drop Hub — actionable TON news, airdrops and quests" />

  <!-- Twitter / X -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="TON Drop Hub — News" />
  <meta name="twitter:description" content="Daily actionable TON ecosystem news: short posts with sources, risks, and links." />
  <meta name="twitter:image" content="https://tdh-site-cie.pages.dev/assets/og.jpg" />
  <meta name="twitter:image:alt" content="TON Drop Hub — actionable TON news, airdrops and quests" />

  <link rel="stylesheet" href="/assets/style.css" />
<script src="/assets/site.js" defer></script>
</head>
<body>
  <div class="container">
    <div class="nav">
      <div class="left">
        <a class="brand" href="/">TON Drop Hub</a>
        <div class="pills">
          <a class="pill" href="/news/">News</a>
          <a class="pill" href="/airdrops/">Airdrops &amp; Quests</a>
          <a class="pill" href="/guides/">Guides</a>
          <a class="pill" href="/projects/">Projects</a>
          <a class="pill" href="/about/">About</a>
        </div>
      </div>
      <span class="badge">MVP</span>
    </div>

    <section class="hero">
      <h1 class="h1">News</h1>
      <p class="sub">Latest updates from TON ecosystem. This page is generated automatically from <code>/news/feed.json</code>.</p>
    </section>

    <!-- FEED -->
    <div id="news-feed" class="grid">
      <!-- Fallback while loading -->
      <div class="card">
        <h2>Loading…</h2>
        <div class="meta">Fetching latest posts</div>
      </div>
    </div>

    <div class="footer">
      <div>Disclaimer: informational only, not financial advice. Never share seed phrases.</div>
    </div>
  </div>

  <script>
    (async function () {
      const FEED_URL = "/news/feed.json";
      const root = document.getElementById("news-feed");

      function escapeHtml(s) {
        return String(s)
          .replaceAll("&", "&amp;")
          .replaceAll("<", "&lt;")
          .replaceAll(">", "&gt;")
          .replaceAll('"', "&quot;")
          .replaceAll("'", "&#039;");
      }

      function normalizeUrl(u) {
        if (!u) return "#";
        const s = String(u).trim();
        if (s.startsWith("http://") || s.startsWith("https://") || s.startsWith("/")) return s;
        return "/" + s;
      }

      function formatDate(v) {
        if (!v) return "";
        // Accept ISO strings and also raw text (we'll keep raw if parsing fails)
        const d = new Date(v);
        if (isNaN(d.getTime())) return String(v);
        // Nice stable format: YYYY-MM-DD
        const yyyy = d.getFullYear();
        const mm = String(d.getMonth() + 1).padStart(2, "0");
        const dd = String(d.getDate()).padStart(2, "0");
        return `${yyyy}-${mm}-${dd}`;
      }

      function renderEmpty() {
        root.innerHTML = `
          <div class="card">
            <h2>No news yet</h2>
            <div class="meta">The feed is connected. Articles will appear here automatically after the next bot run.</div>
          </div>
          <div class="card">
            <h2><a href="/news/welcome/">Welcome: how this hub will work</a></h2>
            <div class="meta">Example article • 2026-01-28</div>
          </div>
        `;
      }

      try {
        const res = await fetch(FEED_URL, { cache: "no-store" });
        if (!res.ok) throw new Error("Feed HTTP " + res.status);
        const data = await res.json();

        const items = Array.isArray(data.items) ? data.items : [];
        if (!items.length) {
          renderEmpty();
          return;
        }

        // newest first
        items.sort((a, b) => {
          const da = new Date(a.published_at || a.date || 0).getTime() || 0;
          const db = new Date(b.published_at || b.date || 0).getTime() || 0;
          return db - da;
        });

        const cards = items.slice(0, 50).map(it => {
          const title = escapeHtml(it.title || "Untitled");
          const url = normalizeUrl(it.url || it.path);
          const date = formatDate(it.published_at || it.date || "");
          const excerpt = it.excerpt || it.summary || it.description || "";
          const safeExcerpt = escapeHtml(excerpt).slice(0, 220); // short preview

          return `
            <div class="card">
              <h2><a href="${url}">${title}</a></h2>
              <div class="meta">${date ? `• ${date}` : ""}</div>
              ${safeExcerpt ? `<div style="margin-top:10px;opacity:.9;line-height:1.5;">${safeExcerpt}${excerpt.length > 220 ? "…" : ""}</div>` : ""}
            </div>
          `;
        }).join("");

        root.innerHTML = cards;
      } catch (e) {
        root.innerHTML = `
          <div class="card">
            <h2>Feed error</h2>
            <div class="meta">Could not load /news/feed.json. Try hard refresh (Ctrl+F5).</div>
          </div>
        `;
        console.error(e);
      }
    })();
  </script>
</body>
</html>
